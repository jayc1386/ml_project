---
title: "Practical Machine Learning Course Project"
author: "Jay Chuang"
date: "Sunday, March 22, 2015"
output: html_document
---

## EXECUTIVE SUMMARY

This is the course project for ["Practical Machine Learning"](https://www.coursera.org/course/predmachlearn) offered at [Coursera](http://www.coursera.org) through [Johns Hopkins University](http://www.jhu.edu/). In this exercise, I will utilize a machine learning algorithm to predict a qualitative variable. The data for this experiment comes from [GroupWare@LES's Human Activity Recognition Dataset](http://groupware.les.inf.puc-rio.br/har). This dataset was generated by 6 participants asked to perform barbell lifts correctly and incorrectly in 5 different ways.

## DATA

For the project, the data has already been split in to a training set and a testing set. The training set consists of 19622 observations of 159 variables, while the test set consists of 20 observations of 159 variables. The only differing columns in the two sets are the "classe" column of the training set and the "problem_id" column of the test set. With the machine learning algorithm, I will aim to predict the "classe" for each of the observations in the test set.

First, I will read the data and perform some general data hygiene procedures on it. Perusing through the data, it is apparent that there are many NA entries. All the columns that contain NAs have over 90% of their ovservations missing, this I will remove all them from both the training and test sets.

```{r cache=TRUE}
### SET WORKING LOCATION, READ DATA
setwd("~/R Projects/ml_project")
train <- read.table("pml-training.csv", sep=",", header=T, stringsAsFactors = F)
test <- read.table("pml-testing.csv", sep=",", header=T, stringsAsFactors = F)

### COUNT NAs IN EACH COLUMN
trainnas <- data.frame(colname = character(),nacount = numeric(),stringsAsFactors = F)
testnas <- data.frame(colname = character(),nacount = numeric(),stringsAsFactors = F)
for (col in seq_along(train)){
     trainnas <- rbind(trainnas, data.frame(colname = colnames(train)[col],
                                            nacount = sum(is.na(train[,col])),
                                            stringsAsFactors = F))
     testnas <- rbind(testnas, data.frame(colname = colnames(test)[col],
                                          nacount = sum(is.na(test[,col])),
                                          stringsAsFactors = F))
}

### REMOVE COLUMNS WITH NAs
trainnas <- trainnas[trainnas$nacount > 0,"colname"]
testnas <- testnas[testnas$nacount > 0,"colname"]
train <- train[,!(colnames(train) %in% c(trainnas,testnas,"X"))]
test <- test[,!(colnames(test) %in% c(trainnas,testnas,"X"))]

### SET CHARACTER VECTORS AS FACTORS
for (col in seq_along(train)){
     if (class(train[,col]) == "character"){
          train[,col] <- as.factor(train[,col])
     }
     if (class(test[,col]) == "character"){
          test[,col] <- as.factor(test[,col])
     }
}
```

Once they are removed, I will split the data by user name. In my opinion, each human being has a distinct manner of movement and thus it is important to ditiniguish between each user's movements when creating a prediction algorithm. Because I am splitting my data into six separate sets, I will have to run six prediction algorithms.

```{r cache=TRUE}
### SPLIT THE TRAINING AND TEST SETS BY USER NAME
train_adelmo <- train[train$user_name == "adelmo",]
test_adelmo <- test[test$user_name == "adelmo",]
train_carlitos <- train[train$user_name == "carlitos",]
test_carlitos <- test[test$user_name == "carlitos",]
train_charles <- train[train$user_name == "charles",]
test_charles <- test[test$user_name == "charles",]
train_eurico <- train[train$user_name == "eurico",]
test_eurico <- test[test$user_name == "eurico",]
train_pedro <- train[train$user_name == "pedro",]
test_pedro <- test[test$user_name == "pedro",]
train_jeremy <- train[train$user_name == "jeremy",]
test_jeremy <- test[test$user_name == "jeremy",]
```

## PREDICTION
For the machine learning algorithm, I will use the rpart method in the caret package. Again, as I stated previously, I will use six separate predictions for each of the participants. I will first run the train() function from caret and then use the predict() function to get my results for each of observation in the test set.

```{r cache=TRUE}
### FIT MODELS FOR EACH USER
library(caret);library(rpart)
modelFit1 <- train(classe ~., data=train_adelmo, method="rpart")
modelFit2 <- train(classe ~., data=train_carlitos, method="rpart")
modelFit3 <- train(classe ~., data=train_charles, method="rpart")
modelFit4 <- train(classe ~., data=train_eurico, method="rpart")
modelFit5 <- train(classe ~., data=train_pedro, method="rpart")
modelFit6 <- train(classe ~., data=train_jeremy, method="rpart")

### PREDICT CLASSE FOR EACH USER
prediction1 <- as.character(predict(modelFit1, newdata=test_adelmo))
prediction2 <- as.character(predict(modelFit2, newdata=test_carlitos))
prediction3 <- as.character(predict(modelFit3, newdata=test_charles))
prediction4 <- as.character(predict(modelFit4, newdata=test_eurico))
prediction5 <- as.character(predict(modelFit5, newdata=test_pedro))
prediction6 <- as.character(predict(modelFit6, newdata=test_jeremy))
```

## RESULTS
I will write the results into a neat table with the particpant name, the problem id, and the predicted result.
```{r cache=TRUE }
### WRITE ANSWERS TO TABLE
a1 <- cbind("adelmo",test[test$user_name == "adelmo","problem_id"],prediction1)
a2 <- cbind("carlitos",test[test$user_name == "carlitos","problem_id"],prediction2)
a3 <- cbind("charles",test[test$user_name == "charles","problem_id"],prediction3)
a4 <- cbind("eurico",test[test$user_name == "eurico","problem_id"],prediction4)
a5 <- cbind("pedro",test[test$user_name == "pedro","problem_id"],prediction5)
a6 <- cbind("jeremy",test[test$user_name == "jeremy","problem_id"],prediction6)
answers <- data.frame(rbind(a1,a2,a3,a4,a5,a6),stringsAsFactors=F)
colnames(answers) <- c("particpant","problem_id","prediction")
answers[,"problem_id"] <- as.numeric(answers[,"problem_id"])
answers <- answers[with(answers,order(problem_id)),]
print(answers)
```

